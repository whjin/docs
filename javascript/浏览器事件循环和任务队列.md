`JS`的异步机制由事件循环和任务队列构成。

`JS`异步依赖于浏览器或操作系统等完成。`JS`主线程拥有一个执行栈以及一个任务队列，主线程会依次执行代码，当遇到函数时，会先将函数入栈，函数运行完毕后再将函数出栈，直到所有代码执行完毕。

遇到异步操作时，异步操作会由浏览器执行，浏览器会在这些任务完成后，将事件定义的回调函数推入主线程的任务队列中，当主线程的执行栈清空之后会读取任务队列中的回调函数，当任务队列被读取完毕之后，主线程接着执行，从而进入一个无限的循环，这就是事件循环。

1、 浏览器中的`Event Loop`

事件循环中的异步队列有两种：宏任务队列和微任务队列。宏任务队列可以有多个，微任务队列只有一个。

- 常见的宏任务：`setTimeout`、`setInterval`、`setImmediate`、`script`代码块、`I/O`操作、`UI`渲染等
- 常见微任务：`process.nextTick`、`new Promise().then(cb)`、`MutationObserver`等

当宏任务执行完后，会查看是否有微任务队列。如果有，先执行微任务队列中的所有任务，如果没有，会读取宏任务队列中排在最前的任务，执行宏任务的过程中，遇到微任务，依次加入微任务队列。
栈空后，再次读取微任务队列里的任务，以此类推。

2、`Node.js`中的事件循环

`Node.js`中的`Event Loop`和浏览器中的是完全不相同的。`Node.js`采用`V8`作为`JS`的解析引擎，而`I/O`处理方面使用了自己设计的`libuv`，`libuv`是一个事件驱动的跨平台抽象层，封装了不同操作系统一些底层特性，对外提供统一的`API`，事件循环机制也是它里面的实现


